<mat-progress-bar class="theme-progress-bar" mode="indeterminate" *ngIf="!isLoaded">
</mat-progress-bar>

<div class="view-header">
  <!-- Span-tagit tarvitsee otsikon ympärille, että teemassa muotoillaan oikein. -->
  <h1 class="main-header"
      id="courseName"
      *ngIf="courseName.length > 0 && !isInIframe">
    <span>{{courseName}}</span>
  </h1>

  <div class="spacer"></div>

    <button (click)="openInNewTab()"
            class="embedded-button"
            mat-raised-button
            *ngIf="isInIframe"
            >
      <a target="_blank" i18n="@@Avaa uuteen välilehteen">
        Avaa uuteen välilehteen
      </a>
    </button>

  <button aria-label="Kurssin asetukset"
          i18n-aria-label="@@Kurssin asetukset"
          class="settings-button"
          mat-icon-button
          *ngIf="(user.asema === 'opettaja' || user.asema === 'admin') && isParticipant"
          [routerLink]="'/course/' + courseID + '/settings'"
          >
    <mat-icon class="settings-icon">settings</mat-icon>
  </button>

  <button aria-label="Profiili"
          class="settings-button"
          (click)="stopPolling()"
          i18n-aria-label="@@Profiili"
          mat-icon-button
          *ngIf="isParticipant && isInIframe"
          [routerLink]="'/course/' + courseID + '/profile'"
          >
    <mat-icon class="settings-icon">account_circle</mat-icon>
  </button>
</div>

<app-ticket-list
    [courseID]="courseID"
    *ngIf="isParticipant"
    (ticketMessage)="newTicketMessage($event)"
    [user]="user"
    >
</app-ticket-list>

<!-- (clickEvent)="errorClickEvent($event)" -->
<app-error-card
    buttonText="{{ error.buttonText}}"
    i18n-title="{{ error.title }}"
    message="{{ error.message }}"
    *ngIf="isLoaded && error.title.length > 0"
    #ticketError
    title="{{ error.title }}"
    >
</app-error-card>

<!------------ UKK:t ---------------------------------------------------------->

<!-- Älä korvaa ngIf:llä tai sorting ei toimi. -->
<section [ngStyle]="{ 'display': 'isLoaded' ? 'block' : 'none' }">

<div class="input-field-wrapper">
  <h2 class="sub-header" i18n="@@Usein kysytyt kysymykset">
    Usein kysytyt kysymykset
  </h2>

  <ng-container *ngIf="numberOfFAQ !== 0">
    <app-search-bar
        i18n="@@Suodata kysymyksiä"
        (searchResult)="applyFilter($event)"
        >
      Suodata kysymyksiä
    </app-search-bar>
  </ng-container>

</div>

  <div class="no-items-box" *ngIf="numberOfFAQ === 0">
    <p i18n="@@Ei yhtään UKK">
      Yhtään usein kysyttyä kysymystä ei ole lisätty.
    </p>
  </div>

<table  class="theme-table mat-elevation-z1"
        [dataSource]="dataSource"
        [hidden]="dataSource.filteredData.length === 0"
        id="faqTable"
        mat-table
        matSort
        matSortActive="aikaleima"
        matSortDirection="desc"
        #sortFaq="matSort"
        >

  <ng-container matColumnDef="otsikko">
    <th mat-header-cell
        *matHeaderCellDef
        mat-sort-header
        i18n-sortActionDescription="@@Järjestä otsikon mukaan"
        i18n="@@Otsikko"
        sortActionDescription="Järjestä otsikon mukaan"
        >
      Otsikko
    </th>
    <td mat-cell *matCellDef="let element">
      <a [routerLink]="'/course/' + courseID + '/faq-view/' + element.id">
        {{ (element.otsikko.length > maxItemTitleLength)?
          (element.otsikko | slice:0:maxItemTitleLength) + '...':(element.otsikko) }}
      </a>
    </td>
  </ng-container>

  <ng-container i18n-sortActionDescription="@@Järjestä päivämäärän mukaan"
                matColumnDef="aikaleima"
                >
    <th class="align-right" mat-header-cell *matHeaderCellDef mat-sort-header
      sortActionDescription="Järjestä päivämäärän mukaan" i18n="@@Päivämäärä">
      Päivämäärä
    </th>
    <td class="cell-align-right" mat-cell *matCellDef="let element">
      <a  class="cell-align-right"
          [routerLink]="'/course/' + courseID + '/faq-view/' + element.id"
          tabindex="-1"
          >
        {{element.aikaleima | date: 'shortDate'}}
      </a>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="getDisplayedColumnFAQ()"></tr>

  <tr mat-row *matRowDef="let row; columns: getDisplayedColumnFAQ()"></tr>

</table>

  <p class="no-items-message" i18n="@@Ei tuloksia"
      *ngIf="dataSource.filteredData.length === 0 && numberOfFAQ > 0">
    Suodattimella ei löytynyt tuloksia.
  </p>
<!-- <mat-paginator [pageSizeOptions]="[10, 15, 20]" #paginatorFaq [hidden]="numberOfFAQ < 10"
        showFirstLastButtons aria-label="Valitse kysymysten sivu"></mat-paginator> -->


  <div  class="buttons-wrapper theme-actions"
        *ngIf="(user.asema === 'opettaja' || user.asema === 'admin') && isParticipant"
        [ngStyle]="numberOfFAQ === 0 ? {'justify-content': 'flex-start'} :
            {'justify-content': 'flex-end'}">

    <button class="submit-faq-btn"
            (click)="saveRedirectUrl('-faq')"
            color="primary"
            justify-content="flex-end"
            mat-raised-button
            tabindex="-1"
            >
      <a  i18n="@@Uusi UKK"
          [routerLink]="'/course/' + this.courseID + '/submit-faq'">
        Uusi UKK
      </a>
    </button>

  </div>

</section>

<app-error-card *ngIf="errorMessage.length > 0" i18n-title="@@Virhe" title="Virhe"
    message="{{ errorMessage }}" [styles]="{ margin: '1em 20% 1em 20%' }">
</app-error-card>

<!-- <div class="theme-actions">
  <button mat-raised-button *ngIf="isLoaded && isInIframe" color="primary"
  [routerLink]="'/submit/'">Avaa kurssinäkymä</button>
</div> -->

<!-- Anna palautetta osio. Ohjaa käyttäjän ulkoiselle sivulle, jossa on palautelomake. -->
<section class="feedback">
  <h2 class="sub-header" i18n="@@Onko sinulla ongelmia tämän järjestelmän kanssa?">Onko sinulla ongelmia tämän järjestelmän kanssa?</h2>
  <p i18n="@@Entä uusia ideoita, miten voisimme jatkokehittää tätä järjestelmää? Tai herännyt muita ajatuksia liittyen tähän järjestelmään?">
    Entä uusia ideoita, miten voisimme jatkokehittää tätä järjestelmää? Tai herännyt muita ajatuksia liittyen tähän järjestelmään?
  </p>
  <p i18n="@@Palautteen antaminen on täysin vapaaehtoista. Kiitos!">
    Palautteen antaminen on täysin vapaaehtoista. Kiitos!
  </p>
  <div class="theme-actions" [ngStyle]="{ 'justify-content': 'flex-start' }">
    <button mat-raised-button color="primary" onClick="window.open('https://link.webropolsurveys.com/S/6D1CD4B0D938E765')"
      i18n="@@Anna meille palautetta">Anna meille palautetta</button>
  </div>
</section>
