<app-headline></app-headline>

<section [ngStyle]="{ 'margin-top': isInIframe ? '-1.7rem' : ''}">
  <app-ticket-list
      [courseID]="courseID"
      *ngIf="isParticipant"
      (ticketMessage)="newTicketMessage($event)"
      [user]="user"
      >
  </app-ticket-list>
</section>

<app-error-card
    buttonText="{{ error.buttonText }}"
    (clickEvent)="errorClickEvent($event)"
    i18n-title="{{ error.title }}"
    message="{{ error.message }}"
    *ngIf="isLoaded && error !== null"
    #ticketError
    title="{{ error.title }}"
    >
</app-error-card>

<!------------ UKK:t ---------------------------------------------------------->

<!-- Älä korvaa ngIf:llä tai sorting ei toimi. -->
<section [ngStyle]="{ 'display': 'isLoaded' ? 'block' : 'none' }">

<div class="input-field-wrapper">
  <h2 class="sub-header" i18n="@@Usein kysytyt kysymykset">
    Usein kysytyt kysymykset
  </h2>

  <ng-container *ngIf="numberOfFAQ !== 0">
    <app-search-bar
        i18n="@@Suodata kysymyksiä"
        (searchResult)="applyFilter($event)"
        >
      Suodata kysymyksiä
    </app-search-bar>
  </ng-container>

</div>

  <div class="no-items-box" *ngIf="numberOfFAQ === 0">
    <p i18n="@@Ei yhtään UKK">
      Yhtään usein kysyttyä kysymystä ei ole lisätty.
    </p>
  </div>

<table  class="theme-table mat-elevation-z1"
        [dataSource]="dataSource"
        [hidden]="dataSource.filteredData.length === 0"
        id="faqTable"
        mat-table
        matSort
        matSortActive="aikaleima"
        matSortDirection="desc"
        #sortFaq="matSort"
        >

  <ng-container matColumnDef="otsikko">
    <th mat-header-cell
        *matHeaderCellDef
        mat-sort-header
        i18n-sortActionDescription="@@Järjestä otsikon mukaan"
        i18n="@@Otsikko"
        sortActionDescription="Järjestä otsikon mukaan"
        >
      Otsikko
    </th>
    <td mat-cell *matCellDef="let element">
      <a [routerLink]="'/course/' + courseID + '/faq-view/' + element.id">
        {{ (element.otsikko.length > maxItemTitleLength)?
          (element.otsikko | slice:0:maxItemTitleLength) + '...':(element.otsikko) }}
      </a>
    </td>
  </ng-container>

  <ng-container i18n-sortActionDescription="@@Järjestä päivämäärän mukaan"
                matColumnDef="aikaleima"
                >
    <th class="align-right" mat-header-cell *matHeaderCellDef mat-sort-header
      sortActionDescription="Järjestä päivämäärän mukaan" i18n="@@Päivämäärä">
      Päivämäärä
    </th>
    <td class="cell-align-right" mat-cell *matCellDef="let element">
      <a  class="cell-align-right"
          [routerLink]="'/course/' + courseID + '/faq-view/' + element.id"
          tabindex="-1"
          >
        {{ element.aikaleima | date: 'shortDate' }}
      </a>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="getDisplayedColumnFAQ()"></tr>

  <tr mat-row *matRowDef="let row; columns: getDisplayedColumnFAQ()"></tr>

</table>

  <p class="no-items-message" i18n="@@Ei tuloksia"
      *ngIf="dataSource.filteredData.length === 0 && numberOfFAQ > 0">
    Suodattimella ei löytynyt tuloksia.
  </p>
<!-- <mat-paginator [pageSizeOptions]="[10, 15, 20]" #paginatorFaq [hidden]="numberOfFAQ < 10"
        showFirstLastButtons aria-label="Valitse kysymysten sivu"></mat-paginator> -->

  <div  class="buttons-wrapper theme-actions"
        *ngIf="(user.asema === 'opettaja' || user.asema === 'admin') && isParticipant"
        >

    <button class="submit-faq-btn"
            (click)="saveRedirectUrl('-faq')"
            color="primary"
            justify-content="flex-end"
            mat-raised-button
            tabindex="-1"
            >
      <a  i18n="@@Uusi UKK"
          [routerLink]="'/course/' + this.courseID + '/submit-faq'">
        Uusi UKK
      </a>
    </button>

  </div>

</section>

<app-error-card
    i18n-title="@@Virhe"
    message="{{ errorMessage }}"
    *ngIf="errorMessage"
    [styles]="{ margin: '1em 20% 1em 20%' }"
    title="Virhe"
    >
</app-error-card>

<!-- Anna palautetta osio. Ohjaa käyttäjän ulkoiselle sivulle, jossa on palautelomake. -->
<section class="feedback">
  <h2 class="sub-header" i18n="@@Onko sinulla ongelmia tämän järjestelmän kanssa?">Onko sinulla ongelmia tämän järjestelmän kanssa?</h2>
  <p i18n="@@Entä uusia ideoita, miten voisimme jatkokehittää tätä järjestelmää? Tai herännyt muita ajatuksia liittyen tähän järjestelmään?">
    Entä uusia ideoita, miten voisimme jatkokehittää tätä järjestelmää? Tai herännyt muita ajatuksia liittyen tähän järjestelmään?
  </p>
  <p i18n="@@Palautteen antaminen on täysin vapaaehtoista. Kiitos!">
    Palautteen antaminen on täysin vapaaehtoista. Kiitos!
  </p>
  <div class="theme-actions" [ngStyle]="{ 'justify-content': 'flex-start' }">
    <button mat-raised-button color="primary" onClick="window.open('https://link.webropolsurveys.com/S/6D1CD4B0D938E765')"
      i18n="@@Anna meille palautetta">Anna meille palautetta</button>
  </div>
</section>
