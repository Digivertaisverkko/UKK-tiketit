<h2 class="main-header" *ngIf="courseName.length > 0 && !isInIframe"><span>{{ courseName }}</span></h2>

<div class="submit-faq">

  <div id="top-buttons" class="theme-actions">
    <app-to-beginning-button></app-to-beginning-button>
  </div>

  <form action="" #submitForm="ngForm">

    <div class="ticket-header">
      <mat-form-field appearance="fill" class="sub-header">
        <textarea
          [(ngModel)]="faqTitle"
          class="sub-header"
          #autosize="cdkTextareaAutosize"
          autocomplete="off"
          cdkAutosizeMaxRows="3"
          cdkAutosizeMinRows="1"
          cdkTextareaAutosize
          contenteditable
          matInput
          name="faqTitle"
          placeholder="Otsikko"
          i18n-placeholder="@@Otsikko"
          required
        ></textarea>
      </mat-form-field>
      <div class="user-info-block">
        <div class="text-info">
          <span class="theme-profile-name">{{ userName }}</span>
          <div class="theme-label">
            <span i18n="@@Minä">Minä</span>
            -
            <span i18n="@@Tänään">Tänään </span>
            <span>{{ currentDate | date: 'shortTime' }}</span>
          </div>
        </div>
        <img mat-card-avatar src="../../../assets/logos/UniOulu.png" alt="">
      </div>
    </div>

    <section class="short-field-wrapper">
      <mat-form-field class="additional-field" appearance="fill">
        <mat-label i18n="@@Tehtävä">Tehtävä</mat-label>
        <input
          name="faqAssignment"
          [(ngModel)]="faqAssignment"
          matInput
          maxlength="50"
          placeholder=""
          >
      </mat-form-field>
      <div class="characters-label"><span class="theme-label">{{ faqAssignment.length }} / 50</span></div>

      <mat-form-field class="additional-field" appearance="fill">
        <mat-label i18n="@@Ongelman tyyppi">Ongelman tyyppi</mat-label>
        <input
          name="faqProblem"
          [(ngModel)]="faqProblem"
          matInput
          maxlength="50"
          placeholder=""
          >
      </mat-form-field>
      <div class="characters-label"><span class="theme-label">{{ faqProblem.length }} / 50</span></div>
    </section>

    <h2 i18n="@@Kysymys">Kysymys</h2>
    <app-editor [(editorContent)]="faqMessage"></app-editor>

    <h2 i18n="@@Vastaus">Vastaus</h2>
    <app-editor [(editorContent)]="faqAnswer"></app-editor>

    <div class="theme-actions">
      <div class="spacer"></div>
        <button
          mat-raised-button color="primary"
          [disabled]="submitForm.invalid"
          (click)="sendFaq()"
          i18n="@@Lähetä">
          Lähetä
        </button>
    </div>

  </form>

  <!-- ----------- Alkuperäinen kysymys -------------------------------------- -->
  <div *ngIf="originalTicket !== undefined">
    <hr class="theme-divider">
    <h2 class="main-header" i18n="@@Alkuperäinen kysymys">Alkuperäinen kysymys</h2>

    <div class="ticket-header">
      <h3 class="sub-header">{{ originalTicket.otsikko }}</h3>
      <div class="spacer"></div>
      <div class="user-info-block">
        <div class="text-info">
          <span class="theme-profile-name">{{ originalTicket.aloittaja.nimi }}</span>
          <div class="theme-label">
            <span>{{ getSenderTitle(originalTicket.aloittaja.nimi, originalTicket.aloittaja.asema) }} - </span>
            <span *ngIf="isToday(originalTicket.aikaleima); else notToday" i18n="@@Tänään">Tänään</span>
            <ng-template #notToday>
              <span>{{ originalTicket.aikaleima | date: 'shortDate' }}</span>
            </ng-template>
            <span>&nbsp;{{ originalTicket.aikaleima | date: 'shortTime' }}</span>
          </div>
        </div>
        <img mat-card-avatar src="../../../assets/logos/UniOulu.png" alt="">
      </div>
    </div>

    <div class="additional-field" *ngIf="originalTicket.kentat !== undefined && originalTicket.kentat[0] !== null && originalTicket.kentat[0].arvo.length > 0">
      <p class="theme-label" ><span i18n="@@Tehtävä">Tehtävä</span></p>
      <p class="short-field-value">{{originalTicket.kentat[0].arvo }}</p>
    </div>

    <div class="additional-field" *ngIf="originalTicket.kentat !== undefined && originalTicket.kentat[1] !== null && originalTicket.kentat[1].arvo.length > 0">
      <p class="theme-label" i18n="@@Tyyppi">Tyyppi</p>
      <p class="short-field-value">{{ originalTicket.kentat[1].arvo }}</p>
    </div>
    <app-message [messageHtml]=originalTicket.viesti></app-message>
    <hr class="theme-divider">

    <h3 class="sub-header" i18n="@@Keskustelu">Keskustelu</h3>
    <mat-card appearance="outlined" class="answer" *ngFor="let comment of originalTicket.kommentit">
      <mat-card-header>
        <img mat-card-avatar src="../../../assets/logos/UniOulu.png" alt={{comment.lahettaja.nimi}}>
        <mat-card-title class="theme-profile-name">
          {{ comment.lahettaja.nimi }}
        </mat-card-title>
        <mat-card-subtitle class="theme-label">
          <span>{{ getSenderTitle(comment.lahettaja.nimi, comment.lahettaja.asema) }} - </span>
          <span *ngIf="isToday(comment.aikaleima)" i18n="@@Tänään">Tänään</span>
          <span *ngIf="!isToday(comment.aikaleima)" >{{ comment.aikaleima | date: 'shortDate' }}</span>
          {{ comment.aikaleima | date: 'shortTime' }}
        </mat-card-subtitle>
        <div class="spacer"></div>
        <span class="ticket-state" *ngIf="comment.tila === 5" i18n="@@Ratkaisuehdotus">Ratkaisuehdotus</span>
      </mat-card-header>
      <mat-card-content>
        <app-message [messageHtml]=comment.viesti></app-message>
      </mat-card-content>
    </mat-card>

  </div>

</div>
